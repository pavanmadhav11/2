<!DOCTYPE html>
<html>
<head>
    <title>Code to Flowchart</title>
    <!-- Load flowchart.js from reliable CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.15.0/flowchart.min.js"></script>
    <style>
        #flowchart-container {
            width: 100%;
            overflow: auto;
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        #flowchart {
            margin: 0 auto;
        }
        .node rect {
            stroke: #333;
            fill: #fff;
        }
        .arrowheadPath {
            fill: #333;
        }
        .flowchart-link {
            stroke: #333;
        }
    </style>
</head>
<body>
    <h1>Python Code to Flowchart</h1>
    <form method="POST">
        <textarea name="code" rows="10" cols="80" placeholder="Enter Python code here..."></textarea><br>
        <button type="submit">Generate Flowchart</button>
    </form>

    {% if error %}
        <p style="color: red;">{{ error }}</p>
    {% endif %}

    {% if flowchart_data %}
        <h3>Flowchart ({{ flowchart_data.nodes }} nodes)</h3>
        <div id="flowchart-container">
            <div id="flowchart"></div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                try {
                    // Clean any previous flowchart
                    document.getElementById('flowchart').innerHTML = '';
                    
                    // Parse and render the flowchart
                    var chart = flowchart.parse(`{{ flowchart_data.flowchart_text|safe }}`);
                    chart.drawSVG('flowchart', {
                        'x': 0,
                        'y': 0,
                        'line-width': 2,
                        'line-length': 30,
                        'font-size': 14,
                        'font-color': 'black',
                        'line-color': 'black',
                        'element-color': 'black',
                        'fill': 'white',
                        'yes-text': 'yes',
                        'no-text': 'no',
                        'arrow-end': 'block',
                        'scale': 1
                    });
                } catch(e) {
                    console.error('Flowchart error:', e);
                    document.getElementById('flowchart').innerHTML = 
                        '<p style="color:red;">Error rendering flowchart. Please check your code syntax.</p>';
                }
            });
        </script>
    {% endif %}
</body>
</html>
